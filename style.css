// 1. Floating WhatsApp Button - Hide/Show on Scroll
const floatingBtn = document.querySelector(".floating-whatsapp");

if (floatingBtn) {
  let lastScrollTop = 0;

  window.addEventListener("scroll", () => {
    const scrollTop = window.scrollY || document.documentElement.scrollTop;

    if (scrollTop > 300) {
      // Sembunyi saat scroll ke bawah
      if (scrollTop > lastScrollTop) {
        floatingBtn.classList.add("hide");
      } else {
        // Muncul saat scroll ke atas
        floatingBtn.classList.remove("hide");
      }
    } else {
      // Selalu tampil jika di bagian atas
      floatingBtn.classList.remove("hide");
    }

    lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
  });
}

// 2. Musik Background - Autoplay & Kontrol
const bgMusic = document.getElementById("bg-music");
const musicBtn = document.getElementById("music-btn");

if (bgMusic && musicBtn) {
  // Fungsi untuk memulai musik (dipicu oleh klik pengguna)
  function startMusic() {
    bgMusic.play()
      .then(() => {
        console.log("🎵 Musik berhasil diputar!");
        musicBtn.textContent = "🔊 Musik Sedang Diputar";
        musicBtn.style.backgroundColor = "#2ecc71";
      })
      .catch(err => {
        console.log("🔇 Autoplay diblokir oleh browser:", err.message);
        musicBtn.textContent = "▶️ Klik untuk Putar";
        musicBtn.style.backgroundColor = "#e74c3c";
      });

    // Hapus event listener setelah dijalankan sekali
    document.body.removeEventListener("click", startMusic);
    musicBtn.removeEventListener("click", startMusic);
  }

  // Jalankan musik saat pengguna klik halaman atau tombol
  document.body.addEventListener("click", startMusic);
  musicBtn.addEventListener("click", startMusic);

  // Toggle mute/unmute
  musicBtn.addEventListener("click", () => {
    if (bgMusic.muted) {
      bgMusic.muted = false;
      musicBtn.textContent = "🔊 Musik Sedang Diputar";
      musicBtn.style.backgroundColor = "#2ecc71";
    } else {
      bgMusic.muted = true;
      musicBtn.textContent = "🔇 Musik Dibisukan";
      musicBtn.style.backgroundColor = "#f39c12";
    }
  });
}

// 3. Efek Salju - Buat Partikel Dinamis
function createSnowflakes(count) {
  const container = document.getElementById('snow-container');
  if (!container) return;

  for (let i = 0; i < count; i++) {
    const snowflake = document.createElement('div');
    snowflake.classList.add('snowflake');

    // Ukuran acak (2px - 6px)
    const size = Math.random() * 4 + 2;
    snowflake.style.width = `${size}px`;
    snowflake.style.height = `${size}px`;

    // Durasi jatuh acak (3s - 7s)
    const duration = Math.random() * 4 + 3;
    snowflake.style.animationDuration = `${duration}s`;

    // Posisi horizontal acak
    snowflake.style.left = `${Math.random() * 100}vw`;

    // Delay acak agar tidak semua mulai bareng
    snowflake.style.animationDelay = `${Math.random() * 5}s`;

    container.appendChild(snowflake);
  }
}

// Jalankan efek salju saat halaman dimuat
document.addEventListener("DOMContentLoaded", () => {
  createSnowflakes(80); // 80 partikel salju
});
